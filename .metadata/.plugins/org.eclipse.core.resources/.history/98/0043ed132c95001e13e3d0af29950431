document.addEventListener("DOMContentLoaded", function() {
	getStartDate();
	getDeadlineDate();
	getAllUsers();
	getAllBooks();
});

/*------------------------ Denifinindo Datas ------------------------*/
function getStartDate() {
	let today = new Date();
	let date = today.getFullYear() + '-' +
		(today.getMonth() + 1).toString().padStart(2, '0') + '-' +
		today.getDate().toString().padStart(2, '0');
	document.getElementById('inputStartDateLoan').value = date;
}

function getDeadlineDate() {
	let today = new Date();
	let date = today.getFullYear() + '-' +
		(today.getMonth() + 1).toString().padStart(2, '0') + '-' +
		(today.getDate() + 7).toString().padStart(2, '0');
	document.getElementById('inputDeadlineDateLoan').value = date;
}

/*------------------------ Select Usu치rios ------------------------*/
function getAllUsers() {
	$.ajax({
		type: "GET",
		url: "/arcoiris/rest/user/getAllUsers",
		success: function(data) {
			dados = JSON.parse(data);
			displayUsers(dados);
		},
		error: function(info) {
			alert("Erro ao buscar usu치rios: " + info.status + " - " + info.statusText);
		}
	})
}

function displayUsers(listUsers) {
	select = "#selectUsers";
	if (listUsers != "") {
		$(select).html("");
		var option = document.createElement("option");
		option.setAttribute("value", "");
		option.innerHTML = ("Selecione o usu치rio");
		$(select).append(option);

		for (var i = 0; i < listUsers.length; i++) {
			if (listUsers[i].status == 1) {
				var option = document.createElement("option");
				option.setAttribute("value", listUsers[i].CPF);
				option.innerHTML = (listUsers[i].name);
				$(select).append(option);
			}
		}

	} else {
		$(select).html("");

		var option = document.createElement("option");
		option.setAttribute("value", "");
		option.innerHTML = ("Cadastre um usu치rio primeiro!");
		$(select).append(option);
		$(select).addClass("aviso");
	}
}